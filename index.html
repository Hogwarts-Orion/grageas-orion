<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Apertura de Grageas - Hogwarts Ori√≥n</title>
    <style>
        body { 
            margin: 0; background: #0d1117 url('https://i.ibb.co/bMh1c0Tx/1771555355884.png') no-repeat center fixed;
            background-size: cover; font-family: 'Georgia', serif; color: #fff;
            display: flex; flex-direction: column; align-items: center; padding: 20px;
        }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: -1; }
        
        .main-sel-box { width: 95%; max-width: 800px; background: #161b22; border: 1px solid #d4af37; border-radius: 4px; padding: 15px; margin-bottom: 25px; }
        
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        input.mago-input {
            flex: 1; min-width: 200px; padding: 12px; border-radius: 6px; 
            border: 1px solid #d4af37; background: #000; color: #f9e29c; font-size: 16px; box-sizing: border-box;
        }

        #cantidad { width: 100%; background: transparent; border: none; color: #f9e29c; font-size: 18px; outline: none; cursor: pointer; border-top: 1px solid #333; padding-top: 10px; }
        
        .gragea-card { width: 90%; max-width: 450px; background: rgba(10, 10, 10, 0.95); border: 2px solid #d4af37; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .sabor-sel { width: 100%; padding: 10px; background: #000; border: 1px solid #444; border-radius: 6px; color: #fff; margin-bottom: 10px; }
        
        .btn-abrir { background: #f9e29c; color: #000; border: none; padding: 18px 60px; border-radius: 10px; font-weight: bold; font-size: 20px; cursor: pointer; display: none; margin-bottom: 30px; transition: 0.3s; }
        .btn-abrir:hover { background: #fff; transform: scale(1.05); }

        .historial-box { width: 95%; max-width: 600px; background: rgba(0,0,0,0.9); border: 2px solid #d4af37; border-radius: 12px; padding: 20px; }
        .historial-entrada { position: relative; background: rgba(255,255,255,0.05); border-left: 4px solid #d4af37; padding: 15px; margin-bottom: 15px; border-radius: 8px; animation: slideIn 0.5s ease; white-space: pre-wrap; font-size: 14px; }
        
        .btn-copiar {
            position: absolute; top: 10px; right: 10px; background: #d4af37; color: #000;
            border: none; padding: 5px 10px; border-radius: 4px; font-size: 11px; cursor: pointer; font-weight: bold;
        }

        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .footer { color: #d4af37; font-size: 26px; font-weight: bold; margin: 40px 0; }
    </style>
</head>
<body>
    <div class="overlay"></div>
    <h1 style="color:#f9e29c">Hogwarts Ori√≥n - Apertura de Grageas</h1>
    
    <div class="main-sel-box">
        <div class="input-group">
            <input type="text" id="nombre-trabajador" class="mago-input" placeholder="Tu nombre (Trabajador del Caldero)...">
            <input type="text" id="nombre-cliente" class="mago-input" placeholder="Nombre del Mago/Bruja receptor...">
        </div>
        <select id="cantidad" onchange="generarCajas()">
            <option value="0">¬øCu√°ntas grageas quieres abrir? --</option>
            <option value="1">1 gragea</option>
            <option value="2">2 grageas</option>
            <option value="3">3 grageas</option>
        </select>
    </div>

    <div id="contenedor-grageas"></div>
    <button id="btn-magico" class="btn-abrir" onclick="abrirGrageas()">Abrir Grageas ‚ú®</button>

    <div id="historial-seccion" class="historial-box">
        <h2 style="color:#f9e29c; text-align:center; margin-top:0;">üìú Historial de Aperturas</h2>
        <div id="log-content">Cargando historial m√°gico...</div>
    </div>

    <div class="footer">Hogwarts Ori√≥n</div>

    <script>
        const DB_URL = "https://hogwarts-orion-default-rtdb.firebaseio.com/historial.json";

        const SABORES = ["1. Aceitunas ü´í", "2. Ajo crudo üßÑ", "3. Alga marina ü™∏", "4. Aliento de drag√≥n üêâüå¨Ô∏è", "5. Aliento de ogro üßå", "6. Algod√≥n de az√∫car üç≠", "7. Ar√°ndanos ü´ê", "8. Baba de caracol üêå", "9. Bellini ü•Ç", "10. Beso no correspondido üíãüíî", "11. Biber√≥n üçº", "12. Blody Mary ü´óü©∏", "13. Brillo labial üíãüíÑ", "14. Burrito üåØ", "15. Cacahuate ü•ú", "16. Ca√±a de az√∫car üéã", "17. Canela en polvo üçÇ", "18. C√°scara de pl√°tano üçå", "19. Caf√© fr√≠o ‚òï", "20. Caf√© quemado ‚òïüî•", "21. Caldo de murci√©lago ü¶áüç≤", "22. Cebolla caramelizada üßÖ", "23. Cereza üçí", "24. Cerveza üç∫", "25. Chicle de menta üç¨", "26. Chisme express ü´¶‚òïÔ∏è", "27. Chorizo ü•©", "28. C√≠tricos üçã", "29. Coco ü••", "30. C√≥ctel üç∏", "31. Coliflor cruda ü•¶", "32. Cera de o√≠do üëÇ", "33. Champa√±a ü•Ç", "34. Chocolate üç´", "35. Cupcake üßÅ", "36. Donas üç©", "37. Drama queen üëëüíÖüèº", "38. Dulce de leche ü•Æ", "39. Dumpling ü•ü", "40. Durazno üçë", "41. Ensalada ü•ó", "42. Esencia de mandr√°gora üå±", "43. Espinaca cocida üç≤", "44. Espuma de mar üåä", "45. Esti√©rcol de drag√≥n üêâüí©", "46. Ex üëÖ", "47. Exponme üëÄüîÆ", "48. Flor de cactus üåµ", "49. Frutilla üçì", "50. Galleta de avena üç™", "51. Gelatina de sapo üê∏", "52. Guisado üçõ", "53. Guisantes triturados ü´õ", "54. Helado de calabaza üéÉ", "55. Helado de vainilla üç®", "56. Hielo üßä", "57. Hojas secas üçÅ", "58. Hueso drag√≥n tostado ü¶¥", "59. Huevo frito üç≥", "60. Huevo podrido ü•ö", "61. Jarabe de arce üçØ", "62. Jugo de pepino ü•í", "63. Kiwi ü•ù", "64. Leche üêÆ", "65. Leche caducada ü•õ", "66. Leche podrida üßã", "67. Lo juro ‚úãüèª", "68. Manteca de man√≠ ü•ú", "69. Manteca rancia üßà", "70. Margarita üç∏", "71. Martini üç∏", "72. Mate üßâ", "73. Menta üåø", "74. Mezcla de hongos üçÑ", "75. Mermelada de escarabajo ü™≤", "76. Moco ü¶†", "77. Naruto üç•", "78. Negroni ü•É", "79. Onigiri üçô", "80. Ostras vivas ü¶™", "81. Pan con hongos ü´ì", "82. Papas fritas üçü", "83. Pasta de dientes ü™•", "84. Pasta pegajosa üçù", "85. Pastel üç∞", "86. Pepino ü•í", "87. Picante üå∂Ô∏è", "88. Pie de manzana ü•ß", "89. Pimiento asado ü´ë", "90. Pi√±a colada üçπ", "91. Pizza üçï", "92. Pollo asado üçó", "93. Polvos m√°gicos ‚ú®", "94. Pud√≠n üçÆ", "95. Queso mohoso üßÄ", "96. Redflag üö©", "97. Ra√≠z de mandr√°gora üå±", "98. Ron a√±ejo üçæ", "99. Sal marina üßÇ", "100. Sand√≠a üçâ", "101. Sangre ü©∏", "102. Sangre de unicornio ü¶Ñ", "103. Sangre de unicornio oxidada ü¶Ñ", "104. Sardinas enlatadas üêü", "105. Sexo en la playa ü•ÉüèñÔ∏è", "106. Soju üç∂", "107. Sopa de pescado üçµ", "108. Sopa de pescado en mal estado üçµ", "109. Spaguetti üçù", "110. Sudor üí¶", "111. Sudor de troll üßü‚Äç‚ôÇÔ∏èüí¶", "112. Sushi üç£", "113. Tacos üåÆ", "114. Tamal ü´î", "115. Te negro ü´ñüñ§", "116. Tinta de pulpo üêô", "117. Trigo seco üåæ", "118. Tronco podrido ü™µ", "119. Tocino ü•ì", "120. Vino üç∑", "121. V√≥mito ü§Æ", "122. Waffles üßá", "123. Whisky ü•É"];
        const PREMIOS = ["Saeta de fuego üî•üßπ", "Nimbus 2000 ü™Ωüßπ", "Anillo de Morf√≠n Gaunt üíç", "Varita de sa√∫co ü™ÑüíÄ", "El desiluminador üí°", "Pergamino m√°gico üìú", "El traslador üîÆ", "Carta vociferadora üíå", "Giratiempo ‚è±", "F√©lix felicis üçÄüß™", "Pluma de Hermione ü™∂", "Amortentia üíòüß™", "Pastillas vomitivas üíä", "Ranita Amarilla üíõüç´", "Ranita verde üíöüç´", "Ranita roja ‚ù§üç´", "Ranita negra üñ§üç´", "Ranita rosa ü©∑üç´", "Ranita lila üíúüç´", "Ranita naranja üß°üç´", "Ranita celeste ü©µüç´", "Espejo de Oesed ü™û", "La recordadora de Neville üé±", "Gragea de todos los sabores ü´ò", "Puedes robarle 10.000G a alguien al azar ü™ô", "-10.000G ü™ô", "-5.000G ü™ô", "-2.000G ü™ô", "-500G ü™ô", "-1.500G ü™ô", "-8.000p", "-7.000p", "+8.000G ü™ô", "+5.000G ü™ô", "+3.000G ü™ô", "+1.500G ü™ô", "-10.000p", "+2 ranitas a elecci√≥n", "+3 ranitas a elecci√≥n", "Se te restan dos productos de tu inventario (al azar)", "+10.000p", "+8.000p", "+5.000p", "Puedes robarle 10.000p a alguien", "Puedes robarle 8.000p a alguien", "Puedes robarle 5.000p a alguien", "Debes donarle 5.000G a alguien ü™ô", "Puedes restarle 5.000p a un compa√±ero", "Puedes sumarle 5.000p a un compa√±ero"];

        function cargarHistorialGlobal() {
            fetch(DB_URL).then(res => res.json()).then(data => {
                const log = document.getElementById('log-content');
                if(!data) { log.innerHTML = "No hay registros."; return; }
                let html = "";
                const entradas = Object.values(data).reverse();
                entradas.forEach(e => html += e);
                log.innerHTML = html;
            });
        }

        setInterval(cargarHistorialGlobal, 5000);
        window.onload = cargarHistorialGlobal;

        function generarCajas() {
            const num = document.getElementById('cantidad').value;
            const container = document.getElementById('contenedor-grageas');
            container.innerHTML = "";
            if (num > 0) {
                document.getElementById('btn-magico').style.display = "inline-block";
                let opts = `<option value="Inc√≥gnito">-- Elegir Sabor --</option>`;
                SABORES.forEach(s => opts += `<option value="${s}">${s}</option>`);
                for (let i = 1; i <= num; i++) {
                    const card = document.createElement('div');
                    card.className = 'gragea-card';
                    card.innerHTML = `<span style="color:#f9e29c; font-weight:bold;">Gragea ${i}:</span>` + 
                                     `<select class="sabor-sel sabor-box-${i}">${opts}</select>` +
                                     `<select class="sabor-sel sabor-box-${i}">${opts}</select>` +
                                     `<select class="sabor-sel sabor-box-${i}">${opts}</select>`;
                    container.appendChild(card);
                }
            }
        }

        function abrirGrageas() {
            const trabajador = document.getElementById('nombre-trabajador').value || "Mago an√≥nimo";
            const cliente = document.getElementById('nombre-cliente').value || "Alguien especial";
            const num = document.getElementById('cantidad').value;
            
            let textoCopiable = `‚ãÜ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚úß‚ó¶üçª‚ó¶‚úß‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ‚ãÜ\n\n`;
            textoCopiable += `‚ï∞‚îà‚û§ …¢ Ä·¥Ä…¢·¥á·¥Ä ·¥Ö·¥á ·¥õ·¥è·¥Ö·¥èÍú±  ü·¥èÍú± Íú±·¥Ä ô·¥è Ä·¥áÍú± ü´ò\n\n`;

            for (let i = 1; i <= num; i++) {
                textoCopiable += `Gragea ${i}\n`;
                const selects = document.querySelectorAll(`.sabor-box-${i}`);
                selects.forEach(sel => {
                    const sabor = sel.value === "Inc√≥gnito" ? "Sabor Sorpresa ‚ùì" : sel.value;
                    const premio = PREMIOS[Math.floor(Math.random() * PREMIOS.length)];
                    textoCopiable += `${sabor} ‚ü∂ ${premio}\n\n`;
                });
            }

            textoCopiable += `‚ãÜ ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚úß‚ó¶üçª‚ó¶‚úß‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî ‚ãÜ\n`;
            textoCopiable += `@${cliente} | Atendido por: ${trabajador}`;

            const id = Date.now();
            const entradaHtml = `
                <div class="historial-entrada" id="entry-${id}">
                    <button class="btn-copiar" onclick="copiarTexto('${id}')">COPIAR üìã</button>
                    <div id="text-${id}">${textoCopiable}</div>
                </div>`;

            fetch(DB_URL, {
                method: 'POST',
                body: JSON.stringify(entradaHtml)
            }).then(() => {
                generarCajas();
                cargarHistorialGlobal();
            });
        }

        function copiarTexto(id) {
            const texto = document.getElementById(`text-${id}`).innerText;
            navigator.clipboard.writeText(texto).then(() => {
                alert("‚ú® ¬°Mensaje m√°gico copiado al portapapeles!");
            });
        }
    </script>
</body>
</html>
